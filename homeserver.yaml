# Configuration file for Synapse.
#
# This is a YAML file: see [1] for a quick introduction. Note in particular
# that *indentation is important*: all the elements of a list or dictionary
# should have the same indentation.
#
# [1] https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html
#
# For more information on how to configure Synapse, including a complete accounting of
# each option, go to docs/usage/configuration/config_documentation.md or
# https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html
server_name: "msg.${DOMAIN}" # Replace with your own domain, this is what the matrix backend will run, not what the users type in their browser
web_client_location: https://chat.${DOMAIN}
pid_file: /data/homeserver.pid
listeners:
  - port: 8088
    tls: false
    type: http
    x_forwarded: true
    resources:
      - names: [ client, federation ]
        compress: false

# TODO: Update these values to the correct ones to moch the gitlab oauth login
oidc_providers:
  - idp_id: gitlab
    idp_name: Gitlab
    idp_brand: "gitlab"  # optional: styling hint for clients
    issuer: "https://gitlab.com/"
    client_id: "your-client-id" # TO BE FILLED
    client_secret: "your-client-secret" # TO BE FILLED
    client_auth_method: "client_secret_post"
    scopes: ["openid", "read_user"]
    user_profile_method: "userinfo_endpoint"
    user_mapping_provider:
      config:
        localpart_template: '{{ user.nickname }}'
        display_name_template: '{{ user.name }}'

# If desired you can update this database to a different configuration. The current one will work with the suplied docker-compose setup.
database:
  name: psycopg2
  args:
    user: synapse
    password: ${POSTGRES_PASSWORD}
    dbname: synapse
    host: db
    port: 5433
    cp_min: 5
    cp_max: 10

# These are your rate limits, adjust to your desired values.
rc_message:
  per_second: 10 # How many can a user sent per second, each and every second if they wish
  burst_count: 30 # How many can a user sent in a occasional bursts, sending 15 in quick succession does mean they then have to wait until the per second limit catches up.
rc_media_create:
  per_second: 1.0
  burst_count: 3.0
rc_login:
  per_second: 5.0
  burst_count: 10.0

enable_registration_without_verification: true  # Remove when using oAuth2 or SSO
enable_registration: true                       # Remove when using oAuth2 or SSO
report_stats: false
require_auth_for_profile_requests: true
suppress_key_server_warning: true
allow_per_room_profiles: false                  # Change to true if we want users to change their username/avatar per room
dynamic_thumbnails: true
url_preview_enabled: true
enable_set_displayname: false                   # Change to true if we want users to have a differnt display name from their username
enable_group_creation: false
enable_room_list_search: true
max_pending_media_uploads: 3
unused_expiration_time: 1h
allow_guest_access: false

push:
  enabled: true
  include_content: false
  group_unread_count_by_room: true
  jitter_delay: 10s

retention:
  enabled: true
  default_policy:
    min_lifetime: 14d # This date is supposedly used in the future, it's kinda vague though.
    max_lifetime: 30d # This seems to be the actual retention period for messages.
  allowed_lifetime_min: 14d
  allowed_lifetime_max: 30d # Same with these other values.
  purge_jobs:
    - longest_max_lifetime: 30d
      interval: 1d
    - shortest_max_lifetime: 14d
      interval: 1d
max_upload_size: 100M # Max size a single upload can be
max_avatar_size: 100M # Max size a single avatar upload can be
max_spider_size: 100M
session_lifetime: 96h
delete_stale_devices_after: 30d
refreshable_access_token_lifetime: 6h
refresh_token_lifetime: 4h

media_retention:
  local_media_lifetime: 30d # How long media uploaded to this server is retained
  remote_media_lifetime: 14d # How long media fetched from other servers is retained

# How much media can be uploaded in this time period, so despite he messages rate limit we can block users from uploading too much media
media_upload_limits:
  - time_period: 1d
    max_size: 1G

# Which rooms should be automatically joined by new users, you can add more rooms here. Make sure the room IDs are correct.
auto_join_rooms:
  - "#general:msg.${DOMAIN}"

# Can also be removed if we use oAuth2 or SSO
password_config:
  policy:
    enabled: true
    minimum_length: 8
    require_digit: false
    require_symbol: false
    require_lowercase: false
    require_uppercase: false

# Paths to various files and directories, make sure these paths are writeable by the synapse process (should be no issue when using docker-compose)
media_store_path: /data/media_store
registration_shared_secret: "bhOhyJgxMi*7oHPrOR1Ns;ikR3cP,GdbcMxtVK24dDLCWr@Lxu"
macaroon_secret_key: "_S1MK:d7dM8u.X.i~V8T6,GIlV+I0b0~GdYNgGb3SAGF,hp=za"
form_secret: "lSJZPookogou=eC_M21E@^U;b9QvrSkdT-7=V,HR8LG2qIX3TS"
signing_key_path: "/data/msg.${DOMAIN}.signing.key"
log_config: "/data/msg.${DOMAIN}.log.config"

trusted_key_servers:
    - server_name: "matrix.org"

user_directory:
  enabled: true
  search_all_users: true
  prefer_local_users: true
  exclude_remote_users: true
  show_locked_users: false

room_list_publication_rules:
  - action: allow

# URL preview blacklist settings, could be usefull if we want to block previews from certain sites on top of the word filter module
url_preview_url_blacklist:
  # blacklist any URL with a username in its URI
  - username: '*'
url_preview_ip_range_blacklist:
  - '127.0.0.0/8'
  - '10.0.0.0/8'
  - '172.16.0.0/12'
  - '192.168.0.0/16'
  - '100.64.0.0/10'
  - '192.0.0.0/24'
  - '169.254.0.0/16'
  - '192.88.99.0/24'
  - '198.18.0.0/15'
  - '192.0.2.0/24'
  - '198.51.100.0/24'
  - '203.0.113.0/24'
  - '224.0.0.0/4'
  - '::1/128'
  - 'fe80::/10'
  - 'fc00::/7'
  - '2001:db8::/32'
  - 'ff00::/8'
  - 'fec0::/10'

# This configures the default power levels in different types of rooms, by setting it above 0 we reserve a role for 'muted' users
default_power_level_content_override:
  private_chat: # Group with invites only
    events:
      "m.room.encryption": 999
      "m.room.message": 10
      "m.room.redaction": 50
    events_default: 10
    users_default: 10 # Default power level for users
    state_default: 100 # Min power level to change room state (moderator or above)
  public_chat: # Open group
    events:
      "m.room.name": 99,
      "m.room.power_levels": 99,
      "m.room.history_visibility": 99,
      "m.room.canonical_alias": 99,
      "m.room.avatar": 99,
      "m.room.tombstone": 99,
      "m.room.server_acl": 99,
      "m.sticker": 10,
      "m.reaction": 10,
      "m.room.pinned_events": 99,
      "m.room.topic": 99,
      "m.room.join_rules": 99,
      "in.cinny.room.power_level_tags": 99,
      "m.room.encryption": 999
      "m.room.message": 10
      "m.room.redaction": 50
    events_default: 10
    users_default: 10
    state_default: 100
  trusted_private_chat: # Direct messages between users
    events:
      "m.room.encryption": 999
      "m.room.message": 10
      "m.room.redaction": 50
    events_default: 10
    users_default: 10
    state_default: 100

server_notices:
  system_mxid_localpart: notices
  system_mxid_display_name: Fapbot Notices
  system_mxid_avatar_url: mxc://msg.fapbot.tech/nsxabiRuNyiKyKEGbEDtFmdV
  room_name: Fapbot Notices
  room_avatar_url: mxc://msg.fapbot.tech/nsxabiRuNyiKyKEGbEDtFmdV
  room_topic: The Almighty Fapbot will send you important notices in this room, make sure to read them!
  auto_join: true

# Custom module configuration
modules:
  # Blocks non System-admin users from creating channels, public or private. Direct messages still allowed
  - module: room_restrict.RoomRestrictor

  # Blocks users from uploading files in direct messages. Again sending user won't really notice, receiving users will not get anything though.
  - module: private_message_file_blocker.PrivateMessageFileBlocker

  # Blocks users below the configured power level from editing their messages, they can still edit their messages but the changes won't be visible to other users. This is useful to prevent users from sending a message and then changing it to something else, which can be used to bypass the word filter or send harmful content.
  - module: edit_blocker.EditBlocker
    config:
      required_power_level: 50

  # Sets the power levels for the channel, makes it public, and publishes it when `!channelconfig` is sent in to the below configured values. Can only be used by system admins.
  - module: channel_config_command.ChannelConfigCommand
    config:
      tags:
        "0": { name: "Muted", color: "#ff0000", icon: { key: "ðŸ¤¡" } }
        "10": { name: "Member", color: "#ffffff" }
        "50": { name: "Moderator", color: "#1fd81f" }
        "99": { name: "Admin", color: "#0088ff" }
        "100": { name: "Super Admin", color: "#cb00ff" }
        "999": { name: "Final boss", color: "#000000" }

  # Blocks uploads of file types not in the allowed list. Uses 'libmagic1' MIME type detection, so make sure the allowed types are valid MIME types and not just file extensions. (This is also the only applicable plugin for admins)
  - module: file_type_filter.FileTypeFilter
    config:
      allowed_types: # Only allow these file types to be uploaded, make sure these are valid MIME types.
        - video/mp4
        - video/x-m4v
        - video/webm
        - image/jpeg
        - image/png
        - image/gif
        - image/webp
        - application/octet-stream

  # Replaces the following list of words with ***, semi invisibly to the sending user, but visible to all others.
  - module: word_filter.WordFilter
    config:
      blocked_words: # Add more words as needed, listed words will be censored before being sent to other users
          - facebook
          - bnwo
          - padlet
          - yahoo
          - chatstep
          - jailbait
          - skype
          - teamviewer
          - unsee
          - incest
          - craigslist
          - instagram
          - myspace
          - tox
          - toxxen
          - jit
          - flickr
          - vestimage
          - volafile
          - twitter
          - volafile
          - anydesk
          - motherless
          - whatsapp
          - snapchat
          - lolita
          - rape
          - vyew
          - preteen
          - pthc
          - erome
          - norwalk
          - lolibooru
          - imig
          - anonvote
          - printedpics
          - chaturbate
          - wetransfer
          - nigger
          - r@ape
          - incst
          - anydesk
          - imgbb
          - teengallery
          - pornpros
          - megaporn
          - firesex
          - firegirls
          - 69sex
          - img2597
          - telegram
          - gigatribe
          - wixxchat
          - myCircle
          - taboo
          - chatpic
          - darkwire
          - cutiegarden
          - nigga
          - funkyimg
          - unSee
          - wickr
          - limewire
          - muwire
          - whereby
          - dropbox
          - rateme
          - tiktok
          - nigger
          - pictausch
          - bongacams
          - talky
          - chatpic
          - lovense
          - raping
          - rapist
          - pedophile
          - pedobear
          - paedophile
          - niger
          - hack
          - screenleap
          - kik
          - taboos
          - Taboos
          - niggr
          - rapes
          - raped
          - joinme
          - qtox
          - motherlessmedia
          - motherless
          - r@pe
          - sexchat
          - 4chan
          - qtheaven
          - fetlife
          - qt0x
          - vk
          - t0x
          - piksor
          - sltboard
          - gook
          - assraped
          - temp-exposed
          - pixwox
          - sonja
          - sonjamoos
          - discord
          - discordapp
          - drive.proton
          - jitsi
          - ko-fi
          - Teleguard
          - telegard
          - onlyfan
          - onlyfans
          - goog
          - Lovesne
          - meetinchat
          - 321sexchat
          - sasisa
          - lpsg
          - mega
          - moe
          - iili
          - protem
          - instamodelsworld
          - worldofmodels
          - Session
          - Sess
          - workupload
          - dadandphotographer
          - everiaclub
          - imgscr
          - worldofinstamodels
          - bellaalv
          - whereby
          - bestinstateens
          - motionmuse
          - motherlesspics
          - photocircleapp
          - bestinstacollections
          - t.me
          - imagepond
          - uguu
          - bsky
          - strichliste
          - opengoon
          - vidqu
          - castrate
          - vore
          - sltb
          - xfree
          - sltroom
          - sltb
